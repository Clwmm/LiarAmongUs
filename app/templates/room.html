{% extends "base.html" %}

{% block title %}Room {{ room_id }}{% endblock %}

{% block content %}
    <h2>Room {{ room_id }}</h2>
    <h3>Players:</h3>
    <ul id="player-list">
        {% for player in players %}
            <li>{{ player }}</li>
        {% endfor %}
    </ul>

    <script>
        const roomId = "{{ room_id }}";
        const playerList = document.getElementById("player-list");

        const wsProtocol = location.protocol === "https:" ? "wss" : "ws";
        const ws = new WebSocket(`${wsProtocol}://${location.host}/ws/${roomId}`);

        ws.onmessage = (event) => {
            const data = JSON.parse(event.data);

            if (data.action === "redirect") {
                window.location.href = data.target || "/";
            } else if (data.players) {
                playerList.innerHTML = "";
                data.players.forEach(player => {
                    const li = document.createElement("li");
                    li.textContent = player;
                    playerList.appendChild(li);
                });
            }
        };
    </script>

{% endblock %}
